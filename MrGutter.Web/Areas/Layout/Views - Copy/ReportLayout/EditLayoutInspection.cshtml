@{
    Layout = "_Layout_EditReportLayoutSetting";
    ViewBag.Title = "layout Report";
}
<div class="flex-shrink-1 container-fluid flex-grow-1 container-p-x container-p-y pt-0">

    <div class="layout-demo-wrapper">
        <div class="layout-demo-placeholder w-100">
            <div class="row">
                <div class="col-12">
                    <div class="d-flex justify-content-between mb-1">
                        <div>
                            <h5 class="mb-0">
                                <span id="Inspection-text"> <b>Inspection Page</b></span>
                                <a href="#" id="edit-Inspection-link" title="Edit the Inspection page">
                                    <i class="ti ti-edit"></i>
                                </a>
                            </h5>
                            <input type="text" id="Inspection-input" class="form-control" style="display: none;" />
                        </div>
                        <div class="col-4 text-end">
                            <button type="button" class="btn btn-outline-primary waves-effect" data-bs-target="#fullscreenModal" data-bs-toggle="modal" data-bs-dismiss="modal">View Page</button>
                        </div>
                    </div>

                    <!--Changes-->
                    <div class="card mb-6">
                        <!-- Account -->
                        <div class="card-body pt-4">
                            <form id="formAccountSettings" method="GET" onsubmit="return false" class="form-repeater">
                                <div id="sections-container">
                                    <!-- Existing Sections -->
                                    <div class="section" data-section-index="1">
                                        <div class="row mb-2">
                                            <div class="col-6">
                                                <!-- Thumbnail -->
                                                <div class="card">
                                                    <div class="card-body">
                                                        <img src="/image/inspection1.jpg" style="width:-webkit-fill-available; height:244px;" alt="Thumbnail" class="thumbnail" id="thumbnail">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-6">
                                                <!-- Thumbnail -->
                                                <div class="card">
                                                    <div class="card-body">
                                                        <img src="/image/inspection2.jpg" style="width:-webkit-fill-available; height:244px;" alt="Thumbnail" class="thumbnail" id="thumbnail">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">

                                            <div class="mb-4 col-md-6" data-repeater-items="">
                                                <h5 class=" fs-6 mb-0 mt-1">Description</h5>
                                                <div class="card">
                                                    <div class="card-body">
                                                        <textarea id="autosize-demo1" rows="3" class="form-control"></textarea>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="mb-4 col-md-6" data-repeater-items="">
                                                <h5 class=" fs-6 mb-0 mt-1">Description</h5>
                                                <div class="card">
                                                    <div class="card-body">
                                                        <textarea id="autosize-demo1" rows="3" class="form-control"></textarea>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="mb-4 col-md-6">
                                                <b class="form-label">Inspection</b>
                                                <b class="form-label">
                                                    Style: <b>Standard</b>
                                                    <a href="#" data-bs-toggle="modal" data-bs-target="#exLargeModal">Change</a>
                                                </b>
                                            </div>
                                            <div class="mb-4 col-md-6 text-end">
                                                @*   <span>
                                                <a href="#" title="Delete Section" class="delete-section" onclick="confirmDelete(event, 'Section')">
                                                <i class="ti ti-lg ti-trash-filled text-danger me-2"></i>
                                                </a>
                                                </span> *@


                                                <span>
                                                    <a href="#" data-bs-toggle="modal" title="Delete Section" class="delete-section" onclick="confirmDelete(event, 'Item')">
                                                        <i class="ti ti-lg ti-trash-filled text-danger me-2"></i>
                                                    </a>
                                                </span>


                                            </div>
                                            <div class="items-container">






                                                <div class="item mb-4">


                                                    <div class="row">





                                                        <div class="mb-4 col-md-5">

                                                            <div class="card">
                                                                <div class="card-body mb-4">
                                                                    <form action="/upload" class="dropzone needsclick">
                                                                        <div class="dz-message needsclick">
                                                                            Drop files here or click to upload
                                                                        </div>
                                                                        <div class="fallback">
                                                                            <input name="file" type="file" />
                                                                        </div>
                                                                    </form>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div class="mb-4 col-md-6">
                                                            <div class="card">
                                                                <div class="card-body">
                                                                    <div id="snow-toolbar">
                                                                        <span class="ql-formats">
                                                                            <select class="ql-font"></select>
                                                                            <select class="ql-size"></select>
                                                                        </span>
                                                                        <span class="ql-formats">
                                                                            <button class="ql-bold"></button>
                                                                            <button class="ql-italic"></button>
                                                                            <button class="ql-underline"></button>
                                                                        </span>
                                                                    </div>
                                                                    <div class="snow-editor">
                                                                        Type something...
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div class="mb-4 col-md-1 text-end">
                                                            <span>
                                                                <a href="#" data-bs-toggle="modal" title="Delete Item" class="delete-item" onclick="confirmDelete(event, 'Item')">
                                                                    <i class="ti ti-lg ti-trash-filled text-danger"></i>
                                                                </a>
                                                            </span>
                                                        </div>
                                                    </div>



                                                </div>
                                            </div>
                                            <div class="mt-1 mb-2">
                                                <button type="button" class="btn btn-outline-primary waves-effect add-item-btn">Add Item</button>

                                            </div>

                                        </div>


                                    </div>
                                </div>
                                <hr />
                                <div class="mt-1">
                                    <button type="button" class="btn btn-outline-primary waves-effect" id="add-section-btn">Add Section</button>
                                </div>
                            </form>
                        </div>
                        <!-- /Account -->
                    </div>


                </div>

            </div>
        </div>
    </div>
</div>

<!--Modal for View page button-->
<div class="col-lg-4 col-md-6">
    <div class="mt-4">
        <div class="modal fade" id="fullscreenModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-fullscreen" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="modalFullTitle">Review</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">

                        <div style="width: 100%; height: 100%; border: 1px solid #ccc;">
                            <iframe src="@Url.Content("~/report_view_pages/reportinspection.pdf")" width="100%" height="100%" style="border: none;"></iframe>
                        </div>


                    </div>
                    @*     <div class="modal-footer">
                    <button type="button" class="btn btn-label-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary">Save changes</button>
                    </div> *@
                </div>
            </div>
        </div>
    </div>
</div>

<!--Modal for pop up (Deletion)-->
<!-- Confirmation Modal -->
<div class="modal fade" id="confirmationModal" tabindex="-1" aria-labelledby="confirmationModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmationModalLabel">Confirm Deletion</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this item/section? This action cannot be undone.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteButton">Delete</button>
            </div>
        </div>
    </div>
</div>




<div class="modal fade" id="exLargeModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel4">Choose your section style</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <hr />
            <div class="modal-body">
                <div class="row">
                    <div class="col-1">
                    </div>
                    <div class="col-5">
                        <span>
                            <label><strong>Standard</strong></label> Fits 2 per page
                        </span>
                        <div style="display: flex; align-items: center;" class="mt-4">
                            <input type="radio" name="radio-group" id="option1" style="margin-right: 10px;" />
                            <div class="card">
                                <!-- The card is now empty without the <h1> -->
                                <img src="~/inspection/fittwoperpage.png" />
                            </div>
                        </div>
                    </div>

                    <!-- Second Column -->
                    <div class="col-5">
                        <span>
                            <label>
                                <strong>
                                    Side-by-side
                                </strong>
                            </label> Fits 4 per page
                        </span>
                        <div style="display: flex; align-items: center;" class="mt-4">
                            <input type="radio" name="radio-group" id="option2" style="margin-right: 10px;" />
                            <div class="card">
                                <!-- The card is now empty without the <h1> -->
                                <img src="~/inspection/fitfourperpage.png" />
                            </div>
                        </div>
                    </div>

                </div>

                <div class="row mt-4">
                    <div class="col-1">
                    </div>
                    <div class="col-5">
                        <span>
                            <label><strong>Wide</strong></label> Fits 2 per page
                        </span>
                        <div style="display: flex; align-items: center;" class="mt-4">
                            <input type="radio" name="radio-group" id="option1" style="margin-right: 10px;" />
                            <div class="card">
                                <!-- The card is now empty without the <h1> -->
                                <img src="~/inspection/widefittwoperpage.png" />
                            </div>
                        </div>
                    </div>

                    <!-- Second Column -->
                    <div class="col-5">
                        <span>
                            <label>
                                <strong>
                                    Full
                                </strong>
                            </label> Fits 1 per page
                        </span>
                        <div style="display: flex; align-items: center;" class="mt-4">
                            <input type="radio" name="radio-group" id="option2" style="margin-right: 10px;" />
                            <div class="card">
                                <!-- The card is now empty without the <h1> -->
                                <img src="~/inspection/fullfitoneperpage.png" />
                            </div>
                        </div>
                    </div>
                </div>



            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-label-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary">Save</button>
            </div>
        </div>
    </div>
</div>


<!--Script for delete pop up-->
<!--Script for View page button-->
<script>
    const pdfUrl = '@Url.Content("~/report_view_pages/reportinspection.pdf")';

    pdfjsLib.getDocument(pdfUrl).promise.then(pdfDoc => {
        const pdfViewer = document.getElementById('pdfViewer');
        for (let i = 1; i <= pdfDoc.numPages; i++) {
            pdfDoc.getPage(i).then(page => {
                const viewport = page.getViewport({ scale: 1.5 });
                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');
                canvas.width = viewport.width;
                canvas.height = viewport.height;
                pdfViewer.appendChild(canvas);

                page.render({ canvasContext: context, viewport: viewport });
            });
        }
    }).catch(error => console.error('Error loading PDF:', error));
</script>


<!--Script for edit title text-->
<script>
    document.getElementById('edit-Inspection-link').addEventListener('click', function (e) {
        e.preventDefault();
        var titleText = document.getElementById('Inspection-text');
        var titleInput = document.getElementById('Inspection-input');
        var editIcon = document.getElementById('edit-Inspection-link');
        if (titleInput.style.display === 'none') {
            titleInput.style.display = 'inline-block';
            titleInput.value = titleText.innerText;
            titleText.style.display = 'none';
            editIcon.style.display = 'none';

            titleInput.focus();
        } else {
            titleText.innerText = titleInput.value;
            titleInput.style.display = 'none';
            titleText.style.display = 'inline-block';
            editIcon.style.display = 'inline-block';
        }
    });
    document.addEventListener('click', function (e) {
        var titleText = document.getElementById('Inspection-text');
        var titleInput = document.getElementById('Inspection-input');
        var editIcon = document.getElementById('edit-Inspection-link');
        if (!titleText.contains(e.target) && !titleInput.contains(e.target) && !editIcon.contains(e.target)) {
            if (titleInput.style.display === 'inline-block') {
                titleText.innerText = titleInput.value;
                titleInput.style.display = 'none';
                titleText.style.display = 'inline-block';
                editIcon.style.display = 'inline-block';
            }
        }
    });


</script>

<!--Script for add item and add section and handle deletion pop up-->
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const sectionsContainer = document.getElementById("sections-container");

        // Template for an item
        const getItemTemplate = () => `
                <div class="item mb-4 row">
                    <div class="mb-4 col-md-5">
                        <div class="card">
                            <div class="card-body">
                                <form action="/upload" class="dropzone needsclick">
                                    <div class="dz-message needsclick">
                                        Drop files here or click to upload
                                    </div>
                                    <div class="fallback">
                                        <input name="file" type="file" />
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="mb-4 col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <div class="snow-toolbar">
                                    <span class="ql-formats">
                                        <select class="ql-font"></select>
                                        <select class="ql-size"></select>
                                    </span>
                                    <span class="ql-formats">
                                        <button class="ql-bold"></button>
                                        <button class="ql-italic"></button>
                                        <button class="ql-underline"></button>
                                    </span>
                                </div>
                                <div class="snow-editor">
                                    Type something...
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mb-4 col-md-1 text-end">
                        <span>
                            <a href="#" title="Delete Item" class="delete-item">
                                <i class="ti ti-lg ti-trash-filled text-danger"></i>
                            </a>
                        </span>
                    </div>
                </div>`;

        // Template for a section
        const getSectionTemplate = (index) => `
                <div class="section mb-4" data-section-index="${index}">
                    <div class="row">
       <div class="d-flex justify-content-between align-items-center">
                 <div class="col-md-6 mt-3 mb-3">
                        <label class="form-label fs-5" for="section-title-${index}"><b>Section title</b></label>
                        <input type="type" id="section-title-${index}" class="form-control" value="" />
                </div>
            <div class="mb-4 col-md-6 text-end">
                <span>
                    <a href="#" title="Delete Section" class="delete-section">
                        <i class="ti ti-lg ti-trash-filled text-danger me-2"></i>
                    </a>
                </span>
            </div>
    </div>
                        <div class="items-container">
                            ${getItemTemplate()}
                        </div>
                        <div class="mt-1">
                            <button type="button" class="btn btn-outline-primary waves-effect add-item-btn">Add Item</button>
                        </div>
                    </div>
                </div>`;



        // Add new section
        document.getElementById("add-section-btn").addEventListener("click", () => {
            const sectionIndex = sectionsContainer.children.length + 1;
            const newSection = getSectionTemplate(sectionIndex);
            sectionsContainer.insertAdjacentHTML("beforeend", newSection);
            initializeQuillEditors();
        });

        // Add new item
        sectionsContainer.addEventListener("click", (e) => {
            if (e.target.closest(".add-item-btn")) {
                const section = e.target.closest(".section");
                const itemsContainer = section.querySelector(".items-container");
                itemsContainer.insertAdjacentHTML("beforeend", getItemTemplate());
                initializeQuillEditors();
            }
        });


        let deleteTarget = null;

        // Delete section
        sectionsContainer.addEventListener("click", (e) => {
            if (e.target.closest(".delete-section")) {
                deleteTarget = e.target.closest(".section");
                const modal = new bootstrap.Modal(document.getElementById("confirmationModal"));
                modal.show();
            }
        });

        // Delete item
        sectionsContainer.addEventListener("click", (e) => {
            if (e.target.closest(".delete-item")) {
                deleteTarget = e.target.closest(".item");
                const modal = new bootstrap.Modal(document.getElementById("confirmationModal"));
                modal.show();
            }
        });




        // Confirm delete button action
        document.getElementById("confirmDeleteButton").addEventListener("click", () => {
            if (deleteTarget) {
                deleteTarget.remove();
                deleteTarget = null;

                // Close the modal
                const modalElement = document.getElementById("confirmationModal");
                const modalInstance = bootstrap.Modal.getInstance(modalElement);
                modalInstance.hide();
            }
        });

        function initializeQuillEditors() {
            document.querySelectorAll(".snow-editor").forEach((editor) => {
                if (!editor.classList.contains("ql-container")) {
                    new Quill(editor, {
                        theme: "snow",
                        modules: { toolbar: editor.previousElementSibling },
                    });
                }
            });
        }

        initializeQuillEditors();
    });

</script>
